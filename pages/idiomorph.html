<!doctype html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/idiomorph@0.7.3/dist/idiomorph.min.js"></script>
  <script type="module">
    import { benchmark } from "./common.js";

    let currentStartTime = null;

    // Handle button clicks and capture start timestamp
    document.addEventListener('click', async function (event) {
      if (event.target.id === 'small' || event.target.id === 'big') {
        currentStartTime = event.timeStamp;
        const size = event.target.id;

        try {
          // Fetch the HTML content
          const response = await fetch(`/snippet/${size}?bust=` + Math.random());
          const html = await response.text();

          // Use Idiomorph to morph the target element's innerHTML
          const targetElement = document.getElementById('target');
          Idiomorph.morph(targetElement, html, { morphStyle: 'innerHTML' });

          // Capture end timestamp and benchmark
          const endTime = performance.now();
          benchmark("idiomorph", currentStartTime, endTime);
          currentStartTime = null;
        } catch (error) {
          console.error('Error fetching or morphing content:', error);
          currentStartTime = null;
        }
      }
    });
  </script>
</head>

<body>
  <button id="small">Run small</button>
  <button id="big">Run big</button>
  <div id="target"></div>
</body>

</html>