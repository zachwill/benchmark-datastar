<!doctype html>
<html>

<head>
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.6/dist/htmx.min.js"></script>
  <script type="module">
    import { benchmark } from "./common.js";

    let currentStartTime = null;

    // Handle htmx completion
    htmx.on("htmx:afterSwap", (event) => {
      if (currentStartTime !== null) {
        benchmark("htmx", currentStartTime, event.timeStamp);
        currentStartTime = null;
      }
    });

    // Handle button clicks and capture start timestamp
    document.addEventListener('click', function (event) {
      if (event.target.id === 'small' || event.target.id === 'big') {
        currentStartTime = event.timeStamp;
        const size = event.target.id;
        // I've tested with both htmx.ajax and hx-get, but the results are the same
        // htmx.ajax("GET", `/snippet/${size}?bust=` + Math.random(), "#target");
      }
    });
  </script>
</head>

<body>
  <button id="small" hx-get="/snippet/small" hx-target="#target" hx-swap="innerHTML">Run small</button>
  <button id="big" hx-get="/snippet/big" hx-target="#target" hx-swap="innerHTML">Run big</button>
  <div id="target"></div>
</body>

</html>